server {
    listen 80;
    server_name rdips.waba88.com;
    
    index index.php;
    root /home/www/rd_ip;
    
    # 보안 헤더
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    
    # 디렉토리 인덱싱 비활성화
    autoindex off;
    
    # 클라이언트 요청 크기 제한
    client_max_body_size 2M;
    
    # 관리자 페이지 IP 제한 (선택사항 - 필요시 활성화)
    # location ~ ^/(login|dashboard|admin_manage)\.php$ {
    #     # IP 화이트리스트 적용
    #     include /usr/local/nginx/conf/ip_whitelist.conf;
    #     
    #     fastcgi_pass unix:/tmp/php-cgi.sock;
    #     fastcgi_index index.php;
    #     include fastcgi.conf;
    #     include pathinfo.conf;
    # }
    
    # 중요 파일 접근 차단
    location ~ /\.(ht|git) {
        deny all;
    }
    
    location ~ ^/(config|security|lib)\.php$ {
        deny all;
    }
    
    location ~ \.(sql|md|sh|py|yml|yaml|lock|json)$ {
        deny all;
    }
    
    # 디렉토리 차단
    location ^~ /vendor/ { deny all; }
    location ^~ /agent/ { deny all; }
    location ^~ /script/ { deny all; }
    location ^~ /logs/ { deny all; }
    
    # API 파일 - POST만 허용
    location ~ ^/api_.*\.php$ {
        if ($request_method !~ ^(POST)$ ) {
            return 405;
        }
        include enable-php-pathinfo.conf;
    }
    
    # PHP 처리
    include enable-php-pathinfo.conf;
    
    # 정적 파일 캐싱
    location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$ {
        expires 30d;
    }
    
    location ~ .*\.(js|css)?$ {
        expires 12h;
    }
    
    location ~ /.well-known {
        allow all;
    }
    
    location ~ /\. {
        deny all;
    }
    
    # 로그
    access_log /home/wwwlogs/rdips.waba88.com.log;
    error_log /home/wwwlogs/rdips.waba88.com.error.log;
}